# Cross-Site Scripting (XSS) Lab Documentation

## Overview
This lab involved performing Reflected and Stored Cross-Site Scripting (XSS) attacks against the Damn Vulnerable Web Application (DVWA) at Low, Medium, and High security levels. The objective was to identify and exploit XSS vulnerabilities to understand web application security weaknesses. The lab was conducted using the Kali Linux VM customized for the Cisco Ethical Hacker course, with DVWA accessed at `http://10.6.6.13`. Below is a detailed account of the steps I took and my findings.
Note that, I started with Metasploitable2 before changing to the Ethical Hacker vm.

## Part 1: Reflected Cross-Site Scripting Exploits
Reflected Cross-Site Scripting (XSS) is a type of XSS attack where a malicious script is injected into a web application and immediately reflected back to the user’s browser via a crafted link or form submission. The script is not stored on the server but is embedded in the server’s response, typically through user input fields like search bars or form inputs. When a user clicks a malicious link or submits a vulnerable form, the script executes in their browser, potentially stealing data, redirecting to malicious sites, or performing unauthorized actions. Reflected XSS relies on social engineering, such as phishing, to trick users into triggering the payload.

### Low Security Level
Setup: I logged into DVWA using the credentials admin/password and set the security level to Low via the DVWA Security menu.
  
  ![](screenshots/022113.png)
  ![](screenshots/022209.png)
  
Initial Test: I navigated to the XSS (Reflected) module, entered Reflected_Test in the "What's your name?" field, and submitted it. The response displayed "Hello Reflected_Test."
  
  ![](screenshots/022427.png)
  ![](screenshots/022449.png)
  
Source Code Analysis: By viewing the page source (Ctrl+U) and searching for Reflected_Test (Ctrl+F), I confirmed that user input was directly inserted into the page's HTML, indicating a potential XSS vulnerability.
  
  ![](screenshots/022634.png)
  ![](screenshots/022755.png)
  
Exploit: I entered the payload `<script>alert("You are hacked!")</script>` in the input field and submitted it. An alert box with `"You are hacked!"` appeared, confirming the vulnerability. I reloaded the tab and observed the same alert, demonstrating that the malicious script could execute via a crafted link.

  ![](screenshots/023038.png)

### Medium Security Level
Setup: I changed the security level to Medium and returned to the XSS (Reflected) module.

  ![](screenshots/023322.png)

Initial Attempt: I submitted the same payload `<script>alert("You're HACKED!!!")</script>`. No alert appeared, and the script was displayed as literal text, indicating filtering.

  ![](screenshots/023412.png)

Source Code Analysis: I reviewed the PHP source code by clicking "View Source." The code used `str_replace('<script>', '', $_GET['name'])`, which removed lowercase <script> tags, rendering the payload ineffective.

  ![](screenshots/095729.png)

Bypass: I modified the payload to `<ScRipt>alert("You're HACKED!!!")</ScRipt>`, using mixed case to bypass the filter. The alert box appeared, confirming the site was still vulnerable at Medium security.

  ![](screenshots/100928.png)
  ![](screenshots/023038.png)


### High Security Level
Setup: I set the security level to High and accessed the XSS (Reflected) module.

Initial Attempt: I submitted `<ScRipt>alert("You're HACKED!!!")</ScRipt>`. No alert appeared, indicating stronger filtering.

  ![](screenshots/100928.png)
  ![](screenshots/101023.png)
   
Source Code Analysis: The PHP code used `preg_replace('/<(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i', '', $_GET['name'])`, which removed any variation of <script> regardless of case. However, the > character was not included in the regex, allowing potential bypasses with other tags.

  ![](screenshots/120223.png)
  
Bypass: I used the payload `<img src=x onerror=alert("You're HACKED!!!")>`, which triggered an alert by exploiting an error event on a non-existent image. This confirmed the vulnerability was exploitable using alternative HTML tags.

  ![](screenshots/120402.png)
  ![](screenshots/120428.png)

---

## Part 2: Stored Cross-Site Scripting Exploits
Stored Cross-Site Scripting (XSS) is a type of XSS attack where a malicious script is injected into a web application and stored on the server, typically in a database, message forum, or comment field. Unlike Reflected XSS, the payload is persistently stored and executed in the browser of any user who visits the affected page, without requiring a specific link or action. This makes Stored XSS particularly dangerous, as it can affect multiple users automatically, potentially leading to widespread data theft, session hijacking, or malicious redirects.
  
### Low Security Level

I set the security level to Low and navigated to the XSS (Stored) module.

![](screenshots/120626.png)

I entered XSS Test#1 in the Name field and Stored XSS Test in the Message field, then clicked "Sign Guestbook." Viewing the page source confirmed both inputs were stored in the HTML.

![](screenshots/120912.png)
![](screenshots/121022.png)

I entered test#1 in the Name field and `<script>alert("You're hacked!")</script>` in the Message field. Upon submission, an alert box appeared. Refreshing the page triggered the alert again, confirming the payload was stored and executed on page load.

![](screenshots/124351.png)
![](screenshots/124437.png)
![](screenshots/124704.png)

I reset the database via **"Setup / Reset Database"** to clear the payload.

![](screenshots/125221.png)
![](screenshots/125458.png)


### Medium Security Level

I set the security level to Medium and accessed the XSS (Stored) module.

![](screenshots/125354.png)

I entered XSS Test#1 in the Name field and Stored XSS Test in the Message field. The source code confirmed the inputs were stored.

![](screenshots/125836.png)
![](screenshots/125938.png)
![](screenshots/130007.png)

I submitted `<script>alert("You are hacked!!!!!!")</script>` in the Message field. No alert appeared, and the script was displayed with HTML tags removed and slashes added before quotes, indicating sanitization.

![](screenshots/130240.png)
![](screenshots/130349.png)

The PHP code used `strip_tags()` and `htmlspecialchars()` on the Message field to remove HTML tags and escape special characters. The Name field used `str_replace()` to remove <script> tags.

![](screenshots/132037.png)

I modified the Name field’s maxlength attribute from `10` to `100` using the browser’s Developer Tools (Inspect > Edit maxlength). I then entered `<ScRipt>alert("You are hacked!")</ScRipt>` in the Name field and arbitrary text in the Message field. The alert appeared, confirming a successful bypass. The alert persisted on page refresh.

![](screenshots/132438.png)
![](screenshots/132504.png)
![](screenshots/132714.png)
![](screenshots/132753.png)
![](screenshots/132928.png)

I reset the database to clear the payload.

![](screenshots/133038.png)


### High Security Level

I set the security level to High and accessed the XSS (Stored) module.

![](screenshots/133125.png)

I entered `Test#1` in the Name field and Stored XSS Test in the Message field, confirming storage in the page source.

![](screenshots/133237.png)
![](screenshots/133319.png)
![](screenshots/133401.png)

I submitted `<ScRipt>alert("YOU ARE HACKED!!!")</ScRipt>` in the Message field. No alert appeared, indicating sanitization.

![](screenshots/133614.png)
![](screenshots/133721.png)

The Message field used `strip_tags()` and `htmlspecialchars()`, while the Name field used `preg_replace()` to remove any <script> tag variation.

![](screenshots/134013.png)

I modified the Name field’s maxlength to 100, then entered `<svg onload=alert("You_are_hacked!")>` in the Name field with arbitrary text in the Message field. The alert appeared, confirming the vulnerability was exploitable using the <svg> tag. The alert persisted on page refresh.

![](screenshots/190323.png)
![](screenshots/190948.png)
![](screenshots/193245.png)

I then reset the database to clear the payload once again.

---

## Stored iframe Exploit (Low Security Level)

I set the security level to Low and navigated to the XSS (Stored) module.

I entered iframe in the Name field and `<iframe src="http://h4cker.org"></iframe>` in the Message field. Upon submission, the H4cker website appeared in an iframe below the guestbook entry, demonstrating the potential to redirect users to malicious sites.

I reset the database to clear the payload. (was quite straightforward haha)



## Stored Cookie Exploit (Low Security Level)

I set the security level to Low and accessed the XSS (Stored) module.

I entered cookie in the Name field and <script>alert(document.cookie)</script> in the Message field. An alert box displayed the session cookie, confirming the ability to capture sensitive data.

I attempted the same payload at Medium and High levels. At Medium, I bypassed the filter using <ScRipt> in the Name field after modifying maxlength, and the cookie was displayed. At High, I used `<svg onload=alert(document.cookie)>` in the Name field, which also succeeded.

I reset the database after each test.

---

## Reflection

The successful exploitation of XSS vulnerabilities at Low, Medium, and High security levels in DVWA highlighted significant security weaknesses. At Low security, the lack of input sanitization allowed straightforward script injection. At Medium, basic filtering was bypassed with case manipulation or alternative tags. At High, more sophisticated filters were bypassed using non-script tags like `<img>` and `<svg>`. These vulnerabilities suggest that the application is susceptible to other potential exploits, such as session hijacking or phishing via malicious redirects. In an ethical hacking engagement, these findings would prompt a thorough evaluation for additional vulnerabilities and recommendations for robust input validation and sanitization.
